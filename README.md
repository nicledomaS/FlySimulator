# FlySimulator
Программа, моделирующая поведение мух в замкнутом пространстве.
Как использовать:
1) Запустить приложение.
2) Настроить "Размер" - поля, "Емкость" – одной ячейки, "Тупость" используя ползунки.
3) Нажать кнопку "Запуск" для запуска симуляции. В процессе симуляции используйте кнопку «Добавить» для добавления новых мух на поле. Текущее положение мух на поле отображается количеством живых и мертвых мух в ячейке (красная цифра и серая цифра соответсвенно).
4) Нажать кнопку "Стоп" чтобы остановить симуляцию, откроется окно статистики.
5) Если необходимо еще симулировать перейти к пункту 2, иначе закрыть программу.

Симулятор полета мух состоит из двух частей: 
* Полётное ядро
* Пользовательский интерфейс

Полётное ядро
Написано на  С++, stl и состоит из следующих классов: 
* FlySimulator
	Управляет моделью поведения мух. Добавляет новые потоки, создает мух, настраивает свойства модели. 
	Хранит в себе список добавленных мух, список потоков в котором живут мухи и поле по которому передвигаются мухи.
	Добавляя новую муху, создается новый поток в который передается муха, алгоритм жизни мухи и поле по которому она передвигается.
	Метод stop позволяет немедленно дать сигнал об остановке всех потоков.
	
* Fly
	Выполняет расчет движения, расчет телеметрии. Хранит в себе текущие координаты, врожденную тупость и телеметрию.
	
* Area
	Поле по которому передвигается муха. Поле состоит из ячеек в котором указано общее количество мух и количество мертвых мух.
	Ячейки расположены в ассоциативном контейнере, ключ которого является составное 32-разрядное число из 2 16-разрядных координат X,Y (см. createKey).
	Передвижение мухи по полю есть по сути изменение числа владельцев ячейки. Когда муха создана она пытается приземлиться с произвольными координатами на поле.
	Если у нее это удается в отдельном потоке запускается алгоритм жизни. Вначале муха пытается переместиться по произвольным координатам 
	в соседнюю ячейку (см. goIn), если результат положительный то она освобождает ранее занимаемую ячейку(goOut). 
	Для атомарного изменения ячеек используется мьютекс. Когда муха умирает вызывается метод die, который фиксирует количество мертвых мух в ячейке.
	Получить количество всех мух и мертвых предоставляет метод population.
	

Пользовательский интерфейс
Сделан на Qt, состоит из следующих компонентов:
* Матрица для отображения цикла жизни мух.
	MatrixModel (QAbstractTableModel), QTableView и Renderer – реализация QT MV для таблиц. MatrixModel получает от симулятора данные о популяции мух и отображает в QTableView. 
	Агрегирует в себе поле (Area). Связь осуществляется через сигнально-слотовую связь ля нотификации об изменении состояния поля. 
	Area при каждом изменении состояния отправляет сигнал update(), таким образом MatrixModel реагирует на это слотом updateAll() и перерисовывает таблицу. 
	В функции data() MatrixModel получает данные из Area и конвертирует в формат подходящий для  Renderer.
	Renderer - запрашивает из модели популяцию мух в ячейке и отрисовывает количество живых и мертвых мух.

* Органы управления процессами симуляции и настройки параметров.
	Стандартные контролы из QT SDK не требуют особых заметок.

* Окно отображения статистики.
	Вся статистика собирается в одну строку и отображается в QTextBrowser.

